# Default values for aws-efs-csi-driver-bundle.
# This is a YAML-formatted file.
#
# Values are split into three categories:
#
#   BUNDLE-ONLY  – Used exclusively by the bundle chart on the management
#                  cluster. Never forwarded to the workload chart.
#
#   UPSTREAM     – Forwarded to the workload chart under the `upstream:` key
#                  so Helm routes them to the upstream aws-efs-csi-driver
#                  subchart. The bundle helper combines split registry+repository
#                  fields into a single path the upstream chart expects.
#
#   EXTRAS       – Forwarded to the workload chart at the top level (not under
#                  `upstream:`). Consumed by Giant Swarm extras templates
#                  (NetworkPolicy, VPA, PSS exceptions, etc.).
#
# See the giantswarm.workloadValues helper in templates/_helpers.tpl for the
# exact transformation logic.

# ─── BUNDLE-ONLY ─────────────────────────────────────────────────────────────
# These values are consumed by the bundle chart on the management cluster only.
# They are excluded from the workload chart ConfigMap.

ociRepositoryUrl: oci://gsoci.azurecr.io/charts/giantswarm/aws-efs-csi-driver

# clusterID is set automatically from the App CR / cluster-values ConfigMap.
# It drives IRSA role naming and Flux resource prefixes.
# clusterID: ""

# ─── UPSTREAM ────────────────────────────────────────────────────────────────
# These values are nested under `upstream:` in the workload chart ConfigMap.
# They configure the unmodified upstream aws-efs-csi-driver subchart.
# Note: the helper combines registry + repository into a single path
# (e.g. gsoci.azurecr.io/giantswarm/aws-efs-csi-driver).

# GS container registry (split registry+repository, combined by helper)
image:
  registry: gsoci.azurecr.io
  repository: giantswarm/aws-efs-csi-driver
  tag: "v2.3.0"

sidecars:
  livenessProbe:
    image:
      registry: gsoci.azurecr.io
      repository: giantswarm/livenessprobe
      tag: "v2.17.0"
  nodeDriverRegistrar:
    image:
      registry: gsoci.azurecr.io
      repository: giantswarm/csi-node-driver-registrar
      tag: "v2.15.0"
  csiProvisioner:
    image:
      registry: gsoci.azurecr.io
      repository: giantswarm/csi-provisioner
      tag: "v6.1.0"

controller:
  additionalLabels:
    giantswarm.io/service-type: "managed"
    application.giantswarm.io/team: "phoenix"
  podLabels:
    giantswarm.io/service-type: "managed"
    application.giantswarm.io/team: "phoenix"
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
  nodeSelector:
    node-role.kubernetes.io/control-plane: ""
  tolerations:
    - key: CriticalAddonsOnly
      operator: Exists
    - key: efs.csi.aws.com/agent-not-ready
      operator: Exists
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app: efs-csi-controller
          topologyKey: kubernetes.io/hostname
  serviceAccount:
    name: efs-csi-sa
    annotations: {}

node:
  additionalLabels:
    giantswarm.io/service-type: "managed"
    application.giantswarm.io/team: "phoenix"
  podLabels:
    giantswarm.io/service-type: "managed"
    application.giantswarm.io/team: "phoenix"
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: node-role.kubernetes.io/control-plane
                operator: DoesNotExist
          - matchExpressions:
              - key: eks.amazonaws.com/compute-type
                operator: NotIn
                values:
                  - fargate
                  - hybrid

storageClasses: []

# ─── EXTRAS ──────────────────────────────────────────────────────────────────
# These values are forwarded to the workload chart at the TOP LEVEL (not under
# upstream:). They are consumed by Giant Swarm extras templates, not the
# upstream subchart.

verticalPodAutoscaler:
  controller:
    updateMode: "Auto"
    minAllowed:
      cpu: 100m
      memory: 256Mi
    maxAllowed:
      cpu: 400m
      memory: 512Mi
  node:
    updateMode: "Auto"
    minAllowed:
      cpu: 100m
      memory: 128Mi
    maxAllowed:
      cpu: 400m
      memory: 512Mi

networkPolicy:
  enabled: true

global:
  podSecurityStandards:
    enforced: true
